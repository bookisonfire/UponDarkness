Computer Science 113 - Assignment 1: Developing a Python Program

The prompt was concise and straight forward. It would have been possible to write a small game that ran through just a few decisions and kept it short and sweet. I starting thinking up a story and wanted to take this game a bit further than I had to. I got worried about half way through that I went to far, but I wanted to put my mind to it and complete something challenging. The bulk (about 70%) of the code is all just the story broken into small scenes that end in a decision. 
The code is broken into 3 sections. First are the functions that dictate game behavior and decisions. Things like saving and changing scenes. I also implemented a nice clean choose() function that is called any time the user is presented with a choice that gives a nice prompt, enumerated options, saves the choice to the decisions list, and gives the user the ability to save or quit. 
Second is the main storyline. I realized I went a bit too far, but wanted to leave myself room to add onto this game in the future without having to go add new starting locations. Just write more story.
And third is the main function that runs the game loop.


### PROMPT ###
# Create a text based adventure game in Python

#1. Display a welcome message and instructions
#2. Include a main() function that controls the game flow
#3. Ask play to enter name and validate using regex/re module
#4. Present user with choices using if/elif/else statements
#5. Use at least 2 additional functions aside from main() and display_title(),
#     to control sections of the story.
#6. Store the players decisions in a list. 
#     - Line 213 inside choose() function, the decision is added to the list.
#7. Use a loop to allow the player to replay the game.
#8. Include at least 1 while loop and 1 dictionary to map outcomes.
#     - Line 220-230 inside death() and win() functions, the outcome is saved.
#9. Save the players game data to a file in JSON using the json module.

from re import *
import json
import random
import time
import os

### FUNCTIONS ###
# Define functions that will be used to control the flow of the game

def display_title():
    print("\n************************************")
    print("***                              ***")
    print("***   Welcome to UPON DARKNESS   ***")
    print("***                              ***")
    print("*** A text-based adventure game! ***")
    print("***                              ***")
    print("************************************")
    print("\nExplore your way through a medieval dungeon filled with bountiful treasures, \nexciting mysteries, and frightful dangers.")
    print("Keep your eyes open...")
    print("It's dark in here.\n")
    print("******************************************************************************")
    print("Instructions:")
    print("1. Enter your adventurer's name (only letters allowed).")
    print("2. Make choices by typing the option number and pressing Enter. There is only 1 route to escape. Choose wisely!")
    print("3. Enter 'q' as your choice to quit, or 's' to save game at any time.")
    print("4. Enjoy the adventure!")
    print("\n******************************************************************************\n")
    input("Press the Enter key to begin...\n")

def new_game():
    # As user to start new game, or load existing game
    choice = choose("Select an option:", ["New Game", "Load Game", "Quit"])
    if choice == 1:
        return "new_game"
    elif choice == 2:
        return "load_game"
    elif choice == 3:
        return "quit"
    elif choice == "quit":
        return "quit"

def get_player_name(state):
    while True:
        type("Enter your adventurer's name:")
        name = input("> ")
        # check if name is only letters using RegEx
        if match("^[A-Za-z]+$", name):
            state["player_name"] = name
            return name
        else:
            print("Invalid name. Please use only letters.")

def get_starting_location():
    locations = {
        "1": "barracks",
        "2": "dungeon",
        "3": "crypt",
        "4": "king_chamber",
        "5": "armory",
        "6": "library"
    }
    type("1. The Barracks\n2. The Dungeon Entrance\n3. The Crypt\n4. The King's Chamber\n5. The Armory\n6. The Library\n7. Random Location")
    choice = input("> ")
    if choice not in locations and choice != "7":
        print("Invalid choice. Please select a number between 1 and 7.")
        return get_starting_location()
    if choice == "7":
        choice = str(random.randint(1, 6))
    if choice.lower() == "q":
        return "quit"
    return locations[choice]

def get_scenes():
    scenes = {
        "barracks": barracks,
        "dungeon": dungeon,
        "crypt": crypt,
        "king_chamber": king_chamber,
        "armory": armory,
        "library": library,
        "kick_bucket_1": kick_bucket_1,
        "kick_bucket_2": kick_bucket_2,
        "pull_chains": pull_chains,
        "pull_chains_free": pull_chains_free,
        "nothing": nothing,
        "leave_library": leave_library,
        "search_king": search_king,
        "open_door_west_wo_key": open_door_west_wo_key,
        "open_door_west_w_key": open_door_west_w_key,
        "open_door_east": open_door_east,
        "arm_yourself": arm_yourself,
        "guard_down": guard_down,
        "open_other_door": open_other_door,
        "fight_back": fight_back,
        "run_door_armory": run_door_armory,
        "fight_armory": fight_armory,
        "climb_window": climb_window,
        "take_cover": take_cover,
        "fight_demons": fight_demons,
        "run_demon": run_demon,
        "kick_bucket_1": kick_bucket_1,
        "kick_bucket_2": kick_bucket_2,
        "magical_demons": magical_demons,
        "fire_wave": fire_wave,
        "bow": bow,
        "bridge": bridge,
        "ladder": ladder,
        "kill_guard": kill_guard,
        "door_run": door_run,
        "capture_guard": capture_guard,
        "wall": wall,
        "hide_room": hide_room,
        "attack_figure": attack_figure,
        "open_door": open_door,
        "bang_door_bad": bang_door_bad,
        "bang_door_good": bang_door_good,
        "run_away": run_away,
        "move_box": move_box,
        "throw_mouse": throw_mouse,
        "fight_man": fight_man,
        "search_figure": search_figure,
        "drink_invisible": drink_invisible,
        "open_door_invisible": open_door_invisible,
        "pull_chains_free": pull_chains_free,
        "pull_chains": pull_chains,
        "fight_remaining_guards": fight_remaining_guards,
        "crypt_hallway": crypt_hallway,
        "hide_cell": hide_cell,
        "open_box": open_box
    }
    return scenes

# Keep track of which scene the player is currently in and the previous scene
# so that the player can smoothly return to the previous scene
def change_scene(state, new_scene):
    state["previous_scene"] = state["scene"]
    state["scene"] = new_scene


def save_game_data(state):
    game_data = {
        "player_name": state.get("player_name", ""), # use get() to avoid KeyError
        "scene": state.get("scene", ""),  
        "chains": state.get("chains", False), 
        "previous_scene": state.get("previous_scene", ""), 
        "decisions": state.get("decisions", []),
        "outcome": state.get("outcome", "")
    }
    try:
        with open("game_data.json", "w") as file:
            json.dump(game_data, file, indent=4)
        print("Game data saved to game_data.json")
    except Exception as e:
        print(f"Error saving game data: {e}")

def load_game_data():
    if os.path.exists("game_data.json"):
        try:
            with open("game_data.json", "r") as file:
                game_data = json.load(file)
                return {
                    "player_name": game_data.get("player_name", ""),
                    "scene": game_data.get("scene", ""),
                    "previous_scene": game_data.get("previous_scene", ""),
                    "decisions": game_data.get("decisions", []),
                    "chains": game_data.get("chains", False),
                    "outcome": game_data.get("outcome", "")
                    }
        except FileNotFoundError:
            print("No saved game data found.")
            return None
    
def replay(state):
    replay_choice = choose("Select an option:", ["Replay the scene.", "Restart the game.", "Quit."], state)
    if replay_choice == 1:
        change_scene(state, state["previous_scene"])
    elif replay_choice == 2:
        main()
    else:
        print("Thank you for playing!")
        exit()
    
def choose(prompt, options, state):
    print()
    type(prompt)
    for i, option in enumerate(options, 1): #give each option a number
        type(f"{i}. {option}")
    print("\nEnter: [s]Save Game [q]Quit\n")
    choice = input("> ")
    if choice.lower() == "s":
        save_game_data(state["player_name"], state["scene"], state["decisions"], state["chains"], state["previous_scene"], state["outcome"])
        return choose(prompt, options, state)
    if choice.lower() == "q":
        return "quit"
    if choice.isdigit() and 1 <= int(choice) <= len(options):
        # store the text of the decision
        state["decisions"].append(options[int(choice) - 1])
        return int(choice)
    else:
        print("\nInvalid choice. Please select a number between 1 and", len(options), "\n")
        return choose(prompt, options)
    
def death(reason, state):
    print("\n<--------------------YOU DIED!-------------------->\n")
    # use time.sleep() to slow down the pacing so the user isnt overwhelmed with text
    time.sleep(0.5)
    type(reason)
    type("Better luck next time.\n")
    state["outcome"] = "death"
    return replay(state)

def win(state):
    time.sleep(0.5)
    print("\n<--------------------YOU WIN!-------------------->\n")
    print("You have escaped the dungeon. Congratulations!\n")
    state["outcome"] = "win"
    time.sleep(1)
    return replay(state)
    
def nothing(state):
    death("You do nothing forever and die of boredom.", state)

# Typewriter effect to help with pacing.
def type(text, delay=0.0125):
    for char in text:
        print(char, end='', flush=True)
        time.sleep(delay)
    print()
    time.sleep(0.15)

### Story scenes ###

def barracks(state):
    type("You awaken in the barracks. As your eyes adjust, you see a group of guards. They seem to be watching you carefully.")
    type("You continue to come to and start to feel the cold chains around your wrists. You seem to be chained to the wall in the corner of the room.")
    type("Looking around you see a small hole in the wall, about the size of a mouse. There is a bucket next to you. And you see a key on the ground just out of reach.\n")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Talk to the guards.", "Kick the bucket.", "Pull on the chains.", "Do Nothing."], state)
    if choice == 1:
        type("The guards are not interested in your conversation. They tell you to be quiet or you will be punished.")
        time.sleep(0.15)
        choice1 = choose("Select your next action:", ["Talk to the guards.", "Kick the bucket.", "Pull on the chains.", "Do Nothing."], state)
        if choice1 == 1:
            type("You anger the guards. They get out of their seats, grab large clubs, and start to beat you up.")
            time.sleep(0.15)
            death("You are unable to escape. The guards beat you up until you are dead.", state)
        elif choice1 == 2:
            return "kick_bucket_1"
        elif choice1 == 3:
            return "pull_chains"
        elif choice1 == 4:
            return "nothing"
        elif choice1 == "quit":
            return "quit"
    elif choice == 2:
        return "kick_bucket_1"
    elif choice == 3:
        return "pull_chains"
    elif choice == 4:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def crypt(state):
    type("You awaken in the crypt. It's pitch black. The only light source is distant candlelight glistening on the metal bar door to the room you're in.")
    type("It appears you're in a cell, deep in the depths of the crypt. The faint sound of rats fills the silence.")
    type("You walk towards the door to see whats out there. You're in the center of a long hallway. You shout out to see if anyone is there, but hear nothing back.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Look around the room.", "Bang on the door.", "Do Nothing."], state)
    if choice == 1:
        type("You look around the room. You see a small wooden box in the corner, a small bed roll with a burlap sack as a blanket, and a dead mouse in the corner by the door.")
        time.sleep(0.15)
        choice1 = choose("Select your next action:", ["Move the box.", "Pick up the mouse and throw it down the hallway.", "Do Nothing."], state)
        if choice1 == 1:
            return "move_box"
        elif choice1 == 2:
            return "throw_mouse"
        elif choice1 == 3:
            return "nothing"
        elif choice1 == "quit":
            return "quit"
    elif choice == 2:
        return "bang_door_bad"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def dungeon(state):
    type("You awaken in the dungeon. The ground is wet and it's very dark. You are in a small cave structure and can hear snarling monsters in the distance.")
    type("There's a bow on the ground that you pick up before you walk to the exit of the cave and see a large room with streams of lava. Giant 12 foot red demons are roaming the grounds.")
    type("You can see a ladder that goes up to a trapdoor in the ceiling. It's guarded by several of these demons.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run for the ladder.", "Take Cover.", "Do Nothing."], state)
    if choice == 1:
        type("You sprint out into the room towards the ladder. You run into a group of demons. They begin to charge at you.")
        type("One of the demons spits a ball of fire at you. It hits and sticks to your leg. The fire begins searing through your armor into your skin.")
        type("Then another hits you in your chest. You collapse and another hits your head. They start to engulf you.")
        time.sleep(0.15)
        death("You are unable to escape. The demons engulf you if fire and you die.", state)
    elif choice == 2:
        return "take_cover"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    

def king_chamber(state):
    type("You awaken in the king's chamber. You've been unconcious for a while. The smell of smoke fills the room.")
    type("As you open your eyes, you see the room you're in is burning. Theres a wall has collapsed like it's been hit with something heavy.")
    type("You scan the room and see a large elegant bed, lots of carpets and jewels everywhere. There's a dead body in the middle of the room. It's the king.")
    type("You can see a door to the east and a door to the west.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Search the king.", "Open the door to the west.", "Open the door to the east.", "Do Nothing."], state)
    if choice == 1:
        return "search_king"
    elif choice == 2:
        return "open_door_west_wo_key"
    elif choice == 3:
        return "open_door_east"
    elif choice == 4:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def library(state):
    type("You awaken in a small stuffy room. As your eyes adjust, you notice you're in a library. Its dark and damp but you can see that every inch of wall is covered in bookshelves.")
    type("All the bookshelves are perfectly neat and tidy, not a single page out of place. You begin to look for a door but you can't find one.")
    type("Suddenly you notice a single book thats not quite pushed in all the way.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Pick up the book.", "Do Nothing."], state)
    if choice == 1:
        type("You reach out and grab the out of place book. It seems to be stuck so you give it a strong tug.")
        type("The book falls to the ground and you hear a rumble. Then the bookself begins to come away from the wall, revealing a room behind it.")
        time.sleep(0.15)
        choice1 = choose("Select your next action:", ["Leave the library.", "Do Nothing."], state)
        if choice1 == 1:
            return "leave_library"
        elif choice1 == 2:
            return "nothing"
        elif choice1 == "quit":
            return "quit"
    elif choice == 2:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def leave_library(state):
    type("You squeeze past the back side of the bookshelf and make your way into the king's chamber. You see a large hole in the wall and an advancing army.")
    type("As you scan the room, you see the king's body dead in the center of the room. You see a door to the west and a door to the east.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Search the king.", "Open the door to the west.", "Open the door to the east.", "Do Nothing."], state)
    if choice == 1:
        return "search_king"
    elif choice == 2:
        return "open_door_west_wo_key"
    elif choice == 3:
        return "open_door_east"
    elif choice == 4:
        return "nothing"
    elif choice == "quit":
        return "quit"

def search_king(state):
    type("You run over to the center of the room where the king lies. You begin searching through his belongings.")
    type("You find an ornate blade in a sheath that you attach around your waist. You continue to search and find nothing else besides a small key.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Open the door to the west.", "Open the door to the east.", "Do Nothing."], state)
    if choice == 1:
        return "open_door_west_w_key"
    elif choice == 2:
        return "open_door_east"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def open_door_west_w_key(state):
    type("You make your way over to the door to your left. The key looks too small, but as you insert it, the key magically shapes to the size of the keyhole, allowing you to unlock the door.")
    type("The door swings open and you make you way out into a lobby. There's 4 doors on the wall opposite you. The first 2 doors you try seem to be blocked by something on the other side.")
    type("You open the third door and are greeted by a large fire. You shut the door and open the fourth. You find a staircase that leads down.")
    type("At the bottom of the stairs, you find a door. You open it and find yourself in an armory.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Arm yourself.", "Open the other door.", "Do Nothing."], state)
    if choice == 1:
        return "arm_yourself"
    elif choice == 2:
        return "open_other_door"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def arm_yourself(state):
    type("You make your way into the armory and begin to search through the weapons and armor to find pieces that will fit you.")
    type("You get a bit distracted by the shiny pointy things everywhere that you don't hear the door behind you open.")
    type("A group of 5 guards walk in the room and see you. They notice that you are unaware of them. One sneaks up behind you and smashes you in the back of the head knocking you out.")
    time.sleep(0.15)
    choice = choose("You're unconcious.", ["Enter 1 to continue to next scene.", "Do Nothing."], state)
    if choice == 1:
        return "guard_down"
    elif choice == 2:
        return "nothing"
    elif choice == "quit":
        return "quit"

def open_other_door(state):
    type("You open the other door and are greeted by a large group of guards.")
    type("The first one lands one hard punch and knocks you out. The other guards land a few cheap shots as they carry you to the center of the room.")
    time.sleep(0.15)
    choice = choose("You're unconcious.", ["Enter 1 to continue to next scene.", "Do Nothing."], state)
    if choice == 1:
        return "guard_down"
    elif choice == 2:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def guard_down(state):
    type("You wake up after a few moments. The sterile white walls and teh light glistening off the metal weapons is amplifying the intense pain in your head.")
    type("One of the guards notices that you've woken up and they all turn their attention to you.")
    type("The first one to reach you kicks you in the ribs and you collapse, stuggling to catch your breath.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Try to fight the guards.", "Plead for mercy.", "Do Nothing."], state)
    if choice == 1:
        return "fight_back"
    elif choice == 2:
        type("You attempt to plead with the guards for them to spare your life.")
        type("They all pause for a second and look at each other. you have a glimmer of hope.")
        type("Your hope is immediately lost as they all burst out in laughter. One of the guards responds, 'You are a fool.'")
        type("Another guard kicks your side again, dropping you to your stomach. You hear the sound of a sword being unsheathed.")
        type("With one smooth stroke, the guard lops off your arm and you watch it fall to the ground. The guards begin cackling again before continuing their attack.")
        time.sleep(0.15)
        death("You are unable to escape. The guards killed you.", state)
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"

def open_door_west_wo_key(state):
    type("You rush to the door to your left. You reach for the handle and attempt to open it. It doesn't budge. You hear a bang come from behind you and see the east door fling open.")
    type("Out steps a large burly looking man. He looks at you with a grin and begins walking towards you.")
    type("He closes the distance between you before you have any time to react. He grabs you by the chest and thows you against the wall.")
    type("He meets you there with a strong fist right to your ribs, knocking all the wind out of you. After a few more strong blows, you begin to feel your body go limp.")
    time.sleep(0.15)
    death("You are unable to escape. The king's personal guard beats you to death.", state)

def open_door_east(state):
    type("You rush to the door to your right. You wiggle the handle and it swings open. Its a small broom closet and theres a big burly man standing in front of you.")
    type("He looks at you with a devious grin. 'Well are'nt you a cute one' he says.")
    type("Before you have time to think, he grabs you by the chest and pulls you into the closet.")
    time.sleep(0.15)
    death("You don't want to know this one.", state)

def armory(state):
    type("You awaken in the armory. The walls are a sterile white, and the light reflecting off all the metal weapons is blinding.")
    type("As your eyes struggle to adjust to the light you see a group of guards. They are standing around mumbling to each other.")
    type("One of them notices that you've woken up and they all turn their attention to you.")
    type("The first one to reach you kicks you in the ribs and you collapse, stuggling to catch your breath.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Try to fight the guards.", "Plead for mercy.", "Do Nothing."], state)
    if choice == 1:
        return "fight_back"
    elif choice == 2:
        type("You attempt to plead with the guards for them to spare your life.")
        type("They all pause for a second and look at each other. you have a glimmer of hope.")
        type("Your hope is immediately lost as they all burst out in laughter. One of the guards responds, 'You are a fool.'")
        type("Another guard kicks your side again, dropping you to your stomach. You hear the sound of a sword being unsheathed.")
        type("With one smooth stroke, the guard lops off your arm and you watch it fall to the ground. The guards begin cackling again before continuing their attack.")
        time.sleep(0.15)
        death("You are unable to escape. The guards killed you.", state)
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def fight_back(state):
    type("The guards all brag and boast about their force and prowess. They continue to beat you and cackle to themselves.")
    type("You notice that all of them are too busy celebrating and cheering that they all turned their backs to you for a moment.")
    type("You crawl over to the closest guard, grab him by the leg and drive your shoulder into him, knocking him over.")
    type("Because all the guards are gathered together and prepping for your murder, the guard falls into several other guards, knocking them over as well.")
    type("Two of the guards fall onto each others swords, one dies and the other is screaming in agony. The other guards begin helping the downed guard, giving you a change to come to your feet.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run for the door.", "Fight the guards.", "Do Nothing."], state)
    if choice == 1:
        return "run_door_armory"
    elif choice == 2:
        return "fight_armory"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def run_door_armory(state):
    type("You see a door behind you. You run as fast as you can amidst the chaos. It's unlocked and you're able to open it and run out into the hallway.")
    type("The hall spans what looks like 100 meters, filled with closed doors on either side. You begin sprinting as fast as you can down the hall.")
    type("The faster you run, the longer the hallway seems to get. When all of a sudden, you see one of the doors open about 10 feet in front of you. You come to a sudden stop, waiting to see what will come out.")
    type("A tall shadowy figure steps out from the door and you're frozen in fear. You begin to feel constricted and can not move. You begin to levetate off the ground and have the feeling of getting sucked toward the figure, landing perfectly into his sword.")
    type("He pulls his sword out of your floating body before you fall to the ground.")
    time.sleep(0.15)
    death("You are unable to escape. The Warden killed you.", state)
    
def fight_armory(state):
    type("As you're coming to your feet, one of the guards sees you and swings his giant warhammer and it crashes into the ground only inches from you.")
    type("It takes him a moment to recover and you're able to run to the nearest wall and grab a sword off it. As you turn back around to face the guards, the hammer is already flying through the air at your head.")
    type("You quickly duck under and in one smooth motion, step foward and thrust your sword into the chest of the first guard. As hes falling to the ground you grab him and throw his body at the other guards, knocking them over.")
    type("You pick up the warhammer and swing it at them, crushing one of them. All of a sudden you hear a loud rumble and the ground begins to shake.")
    type("All of a sudden, a giant rock comes crashing in through the window, crushing the remaining guard. You look out and see an entire army attacking the castle you're a prisoner of.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Climb out the window.", "Run for the door.", "Do Nothing."], state)
    if choice == 1:
        return "climb_window"
    elif choice == 2:
        return "run_door_armory"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def climb_window(state):
    type("You run over to the hole in the window and look down. You're on the second story and theres a pile of rubble beneath you. It's an easy jump and youre on the ground floor.")
    type("As you land, you see a group of guards a good distance away that see you and begin charging and firing arrows at you. You turn and see a door. You run through it and into the hall behind it.")
    type("You find 4 doors in the hall. The first 3 you try to open are locked. You reach the fourth handle and feel that its hot to the touch and it burns your hand.")
    type("You let go of the handle and jump backwards. You feel the ground shake and a trapdoor opens up under you and you fall into a dark cave.")
    type("There's a bow on the ground that you pick up before you walk to the exit of the cave and see a large room with streams of lava. Giant 12 foot red demons are roaming the grounds.")
    type("You can see a ladder that goes up to a trapdoor in the ceiling. It's guarded by several of these demons.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run for the ladder.", "Take Cover.", "Do Nothing."], state)
    if choice == 1:
        type("You sprint out into the room towards the ladder. You run into a group of demons. They begin to charge at you.")
        type("One of the demons spits a ball of fire at you. It hits and sticks to your leg. The fire begins searing through your armor into your skin.")
        type("Then another hits you in your chest. You collapse and another hits your head. They start to engulf you.")
        time.sleep(0.15)
        death("You are unable to escape. The demons engulf you if fire and you die.", state)
    elif choice == 2:
        return "take_cover"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"

    
def take_cover(state):
    type("You take out your bow and charge out of the cave. You see a boulder and decide to hide behind it.")
    type("You see a single demon walking towards you from the other end of the dungeon. You draw your bow and launch an arrow right between its eyes.")
    type("It drops to the ground, making a squeeling noise. 2 more demons blocking a bridge to the ladder hear it and make their way towards you.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Fight the demons.", "Run for the downed demon.", "Do Nothing."], state)
    if choice == 1:
        return "fight_demons"
    elif choice == 2:
        return "run_demon"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def fight_demons(state):
    type("You peek out from behind the boulder and attempt to fire an arrow at the first demon, when you see a fast moving ball of fire heading directly at your head.")
    type("You let off your arrow and duck just before the fire ball hits you. You see the arrow hit the demon in the leg. He lets out a deafening howl that makes you drop to your knees.")
    type("As you're recovering, another fire ball goes flying over the boulder. Then another lands on the ground in front of you.")
    type("You stand up and try to attach a new arrow to your bow as a fourth fire ball hits your leg and begins searing through your armor.")
    type("You shoot off one last arrow that connects and drops one of the demons before the other makes it to you, picks you up, and slams you against the wall.")
    time.sleep(0.15)
    death("The demons ripped you apart.", state)

def run_demon(state):
    type("You run for the downed demon. There's something glistening next to him. You grab it as you run by and keep on going, not sure how close the demons are behind you.")
    type("You get to a large rock pillar and see you've made a good bit of distance and there are no other demons in the room.")
    type("You finally see that you picked up a glove. It is stiff but not metal. It has a strange red glow and an incredibly ornate design.")
    type("When you slide the glove onto your hand, it magically forms to you and begins to sizzle fire with sparks flying off the palm, but they don't hurt you.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Fight the demons.", "Do Nothing."], state)
    if choice == 1:
        return "magical_demons"
    elif choice == 2:
        return "nothing"
    elif choice == "quit":
        return "quit"

def magical_demons(state):
    type("You wave the palm of your hand at the demons and a wave of fire comes from it. You engulf the demons in the flames.")
    type("You stare at your new glove, not sure what you just saw. But you're in no place to question it now.")
    type("You're one step closer to the ladder and the way out of this hell. You can see 3 more demons blocking the ladder. And they just watched everything.")
    type("As you begin to make your way back to the first boulder, you see 2 of the demons move down to the bridge as all 3 begin launching fire balls at you.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Try to fire wave the demons.", "Use your bow.", "Get closer to the bridge.", "Do Nothing."], state)
    if choice == 1:
        return "fire_wave"
    elif choice == 2:
        return "bow"
    elif choice == 3:
        return "bridge"
    elif choice == 4:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def fire_wave(state):
    type("You wave the palm of your hand at the demons and a wave of fire comes from it. The demons are too far away and the fire doesn't hurt them.")
    type("They all launch more fire balls at you. 2 of the 3 connect and start to sear through your armor.")
    type("They continue to barrage you with fire. You begin to lose your grip on the glove and it falls off.")
    time.sleep(0.15)
    death("You are unable to escape. The demons engulf you if fire.", state)

def bow(state):
    type("You pull out your bow. When you grab it with your glove, the fire has no effect on the bow. You begin to draw it.")
    type("You launch an arrow at the furthest demon by the ladder. It goes right into its chest and it lets out a deafening howl.")
    type("One of the other demons begins to charge at you. You fire another arrow at the demon still on the bridge as it fires a fire ball at you.")
    type("It seems the glove also makes your bow incredibly accurate and you can't miss. You take down the second demon.")
    type("The last demon is now right in front of you, charging fast. You move the bow to your other hand and send a fire wave at the demon, burning it to the ground.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run to the ladder.", "Do Nothing."], state)
    if choice == 1:
        return "ladder"
    elif choice == 2:
        return "nothing"
    elif choice == "quit":
        return "quit"

def bridge(state):
    type("You begin running towards the bridge as all 3 demons are launching fire balls at you.")
    type("The first few miss as you make it to the boulder. You pause for a second and watch a few more fire balls fly over head.")
    type("You take the lull as an opportunity and run from the boulder to the bridge. As you come out from behind the boulder, one of the fire balls hits you directly in the chest.")
    type("You feel the glove loosen its grip and slide off your hand. You fall to your knees and get hit with 3 more balls of fire.")
    time.sleep(0.15)
    death("You are unable to escape. The demons engulf you in fire.", state)

def ladder(state):
    type("You make it to the ladder and begin to climb it. You make it to the door and push it open. You enter a room of guards. It appears to be their barracks.")
    type("The guards in a drunken stupor attempt to make it to their feet with their swords. You notice a door to your right.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Open the door.", "Fight the guards.", "Do Nothing."], state)
    if choice == 1:
        return "open_door"
    elif choice == 2:
        type("Theres 4 guards in the room. You notice one of the guards run to the back corner and grab a bow. The other 3 are scrambling to get their swords.")
        type("With one smooth motion, you raise your hand and send a wave of fire that rains down on the 3 front guards. As they slump to the ground, the last guards lays his bow down in surrender.")
        time.sleep(0.15)
        choice = choose("Select your next action:", ["Kill the guard.", "Run for the door.", "Capture the guard.", "Do Nothing."], state)
        if choice == 1:
            return "kill_guard"
        elif choice == 2:
            return "door_run"
        elif choice == 3:
            return "capture_guard"
        elif choice == 4:
            return "nothing"
        elif choice == "quit":
            return "quit"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def kill_guard(state):
    type("It's not nice to kill someone who has surrendered.")
    time.sleep(0.15)
    death("You spontaneously combust for killing the innocent.", state)

def door_run(state):
    type("You let the surrendered guard be and make your way to the door.")
    type("You reach out and jiggle the handle. It doesn't budge.")
    type("As your fiddling with the lock, you hear the sound of a bow being drawn.")
    time.sleep(0.15)
    death("A well placed arrow lands in the center of your back. You drop to the ground, limp.", state)

def capture_guard(state):
    type("You grab the remaining guard and begin tying him up.")
    type("He starts to resist and wrestles with you before hip tossing you into the wall.")
    type("You feel the wall start to cave in just from your weight.")
    type("You gather your composure, grab the guard and throw him into the wall, making it collapse, crushing him.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Search the guards.", "Make your way through the wall.", "Do Nothing."], state)
    if choice == 1:
        type("You start searching the other guards for a key before checking the guard under the wall.")
        type("None of them have anything interesting, but you do notice a few keys on the bookshelf next to one of the beds.")
        type("You take the keys.")
        time.sleep(0.15)
        choice1 = choose("Select your next action:", ["Make your way through the wall.", "Go unlock the door." "Do Nothing."], state)
        if choice1 == 1:
            return "wall"
        if choice1 == 2:
            type("You make your way to the door and start fumbling through the keys, trying to find the one that fits.")
            type("You try 3 or 4 before you hear a noise come from the crumbled wall.")
            type("You turn and see a shadowy figure making his way over the rubble.")
            type("As he starts walking towards you, your throat starts to tighten and your body goes stiff.")
            type("The feeling gets stronger as he walks towards you. Then, as if being lifted up by a ghost, \nyou start to levetate off the ground before the man thrusts his sword into your chest.")
            time.sleep(0.15)
            death("You are unable to escape.", state)
        if choice1 == 3:
            return "nothing"
        if choice1 == "quit":
            return "quit"
    elif choice == 2:
        return "wall"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def wall(state):
    type("You make your way over the rubble and throught the hole in the wall. It leads to a long dark hallway.")
    type("At the end of the hallway you see a shadowy figure appear from the darkness. It walks towards you and you feel a wave of fear.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Attack the figure.", "Hide inside the room.", "Do Nothing."], state)
    if choice == 1:
        type("You take a few steps toward the figure and hold your hand up, ready to blast fire at it.")
        type("The figure steps forward and the flames on your glove begin to weaken until finally it stops all together.")
        type("One more step and the glove begins to loosen off your hand and fall to the ground. You grab your bow and attempt to launch an arrow at the figure.")
        type("The arrow stops only a few feet in front of you and floats in the air for a few seconds before falling to the ground.")
        type("Then, as if being lifted up by a ghost, you start to levetate off the ground before the man apears in front of you and thrusts his sword into your chest.")
        time.sleep(0.15)
        death("You are unable to escape.", state)
    elif choice == 2:
        return "hide_room"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def hide_room(state):
    type("You turn around and begin looking for object to hide behind. You see a bookshelf and a bed.")
    type("You choose to move the bookshelf infront of the wall and then hide behind the bed.")
    type("You hear a deep rumble before the bookshelf goes flying across the room, crashing into the wall and breaking into pieces.")
    type("The figure makes his way into the room and walks right past the bed your behind and walks towards the door on the other end of the room.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Attack the figure.", "Run for the hole in the wall.", "Do Nothing."], state)
    if choice == 1:
        return "attack_figure"
    elif choice == 2:
        return "run_away"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def attack_figure(state):
    type("You sneak out from behind the bed and start making your way to the figure.")
    type("As you step over a dead body you pick up his sword.")
    type("A few more steps and your right behind the figure. You thrust your sword between his armor and into his ribcage.")
    type("The man falls to the ground and fizzles into a pile of ash, leaving just his things behind.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run out the door.", "Search the room.", "Do Nothing."], state)
    if choice == 1:
        return "run_away"
    elif choice == 2:
        return "search_figure"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"

    
def open_door(state):
    type("You race to open the door before the guards can get their berrings.")
    type("You get to the door and reach out for the handle. It's locked!")
    type("The guards have now gathered their swords and are advancing towards you when one of the guards in the back of the room fires an arrow at you.")
    type("The arrow lands right between your eyes. You drop to the ground, limp.")
    time.sleep(0.15)
    death("'I was once an adventurer like you, then I took an arrow to the knee.'", state)

    
def bang_door_bad(state):
    type("You bang on the door. It doesn't budge.")
    type("All of a sudden, the faint glisten of light gets brighter. A large shadowy figure appears in the door holding up a torch in one hand and a large sword in the other.")
    type("The silence is deafening as the door slowly creaks open all on its own. The man tosses the torch to the ground outside your door before walking towards you.")
    type("Without a word, the man walks through the door and it shuts behind him. Your throat starts to tighten up and it becomes harder to breathe.")
    type("As if being lifted up by a ghost, you start to levetate off the ground before the man thrusts his sword into your chest.")
    time.sleep(0.15)
    death("You are unable to escape.", state)
    
def move_box(state):
    type("You attempt to move the box. The top of it feels loose, and you're able to remove it.")
    type("You hear a noise outside the door and you hurridly put the lid back on as you see a sparkle come from inside the box.")
    type("You lay down on the bed roll as a shadowy figure holding a torch and large sword walks past your door, peering in as he passes.")
    type("You jump back up and take the lid back off the box. You find a small blade in the box and pick it up.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Bang on the door.", "Throw dead mouse down the hall.", "Do Nothing."], state)
    if choice == 1:
        return "bang_door_good"
    elif choice == 2:
        return "throw_mouse"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def bang_door_good(state):
    type("With the knife in hand, you clank the metal of the blade against the metal bar door. Down the hall you see the man from before turn around and begin walking towards you.")
    type("You hurridly move into the front corner of the room by the dead rat, trying to hide from anyone by the door.")
    type("Without a noise, the door flies open, kicking up a cloud of dust. The man takes a few steps into the door, surveying the room trying to find the source of the noise.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run out the door.", "Fight the man.", "Do Nothing."], state)
    if choice == 1:
        return "run_away"
    elif choice == 2:
        return "fight_man"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def run_away(state):
    type("You sprint out of the room and run down the hallway. To your right, you see a wall at the end of the hall. You run to the left where you can see the hallway turns down the way.")
    type("You run down the hallway and find a small door at the end. You open it and are immediately greeted by a dozen guards. They begin to charge at you.")
    type("You slam the door shut and turn to run when you see the shadowy figure from before walking towards you. Then the door behind you bursts open and the guards pour out.")
    type("One of the guards behind you sends one lone arrow from his bow at you. It connects right between your shoulders and you drop to the ground.")
    time.sleep(0.15)
    death("You are unable to escape. The guards beat you up until you are dead.", state)
    
def fight_man(state):
    type("While the man is looking around the room, you are able to sneak up behind him silently and send your new blade deep between his armor and directly into his ribcage.")
    type("The man falls to the ground and fizzles into a pile of ash, leaving just his things behind.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run out the door.", "Search the room.", "Do Nothing."], state)
    if choice == 1:
        return "run_away"
    elif choice == 2:
        return "search_figure"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def search_figure(state):
    type("You search through the things the figure had left behind. You find dont find much, but you do see a few small vials of different liquids. They have some weird symbols on them.")
    type("You attempt to pick up and put on some of his armor and when you slide it on, it magically shapes to your body. You feel a strange warmth.")
    type("You begin to make your way down the hall when you come upon a closed door. You can hear a lot of voices on the other side.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Open the door.", "Drink one of the vials.", "Do Nothing."], state)
    if choice == 1:
        return "open_door"
    elif choice == 2:
        return "drink_invisible"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def drink_invisible(state):
    type("You drink one of the vials and feel a power rush over you. Your body begins to tingle. You look down and see that you've turned invisible.")
    type("You quietly open the door and take a few steps just inside. You see a dozen guards in a small room with a door on the other side. You can see the confusion in their faces to seeing the door open, seemingly on its own.")
    type("Amidst the rumble of voices, one of the guards gets up and walks out the now open door, closing it behind him.")
    type("You begin creeping your way past the large group of guards. There are only inches of space between you and them as you sneak by.")
    type("You make it to the door on the other side of the room.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Open the door.", "Do Nothing."], state)
    if choice == 1:
        return "open_door_invisible"
    elif choice == 2:
        type("You decide to stay where you are. Only a few seconds later, the first guard that walked out comes crashing through the door screaming.")
        type("He tells all the other guards to come, the warden has been killed and a prisoner is missing.")
        type("As the guards all swarm out of the room, you notice one of them leaves his keys behind. As they shut the door, the tingling stops and you are no longer invisible.")
        type("You pick up the keys and run to the door. It's locked. You try the different keys until finally one fits the hole and unlocks the door.")
        type("You open the door and are greeted by bright sunlight flooding your eyes. You walk out, closing the door behind you, and sprint out into the woods.")
        time.sleep(0.15)
        win(state)
    elif choice == "quit":
        return "quit"
    
def open_door_invisible(state):
    type("As you reach for the handle, you feel the strong tingle again. Once you make contact with the door you become visible again.")
    type("The guards are startled and immediatly draw their weapons. Once of them shoots an arrow at you that hits you in the ribs.")
    type("You drop to your knees in agony and the other guards begin to charge at you.")
    type("One of them drives their sword straight into your chest.")
    time.sleep(0.15)
    death("You are unable to escape. The guards killed you.", state)


def throw_mouse(state):
    type("You walk over to the front corner of the room and pick up the dead mouse. The smell seeps deep into your nostrils.")
    type("You grab the mouse by the tail and swing it around, throwing it down the hallway. It bounces off the wall and falls to the floor.")
    type("There's a moment of silence before a slow rumble begins. At first it sounds like it's coming from the walls.")
    type("But as it gets closer, you can make out some faint squeeks in the rumble.")
    type("As the rumble turns to a roar, the first few mice turn the corner and easily scurry through the metal bars.")
    type("Before you can react, hundreds of the mice come in from every corner of the room at you. They swarm you and you're unable to escape.")
    time.sleep(0.15)
    death("You are unable to escape and are eaten alive by a horde of mice.", state)
    
def pull_chains(state):
    if state["chains"] == False:
        type("You pull on the chains. They seem to be loose near the wall.")
        type("The chains move and you're able to move your arms.")
        state["chains"] = True
        time.sleep(0.15)
        change_scene(state, state["previous_scene"])
    else:
        type("You've already loosened the chains.")
        time.sleep(0.15)
        change_scene(state, state["previous_scene"])

def pull_chains_free(state):
    type("You pull on the chains. They seem to be loose near the wall. You see a small rock fall out of the wall onto the floor.")
    type("As you continue to pull harder, it seems that the mouse hole weakened the wall and it starts to buckle.")
    type("One last hard pull and you're able to pull enough of the wall down that you can squeeze through the hole.")
    type("The drunken guards stunned by the cloud of dust. One of them scurries off to get help.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Run through the hole.", "Fight the remaining guards.", "Do Nothing."], state)
    if choice == 1:
        type("You run through the hole and get out of the room. You make it to the crypt.")
        time.sleep(0.15)
        return "crypt_hallway"
    elif choice == 2:
        return "fight_remaining_guards"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def crypt_hallway(state):
    type("In all the chaos, you run into the new hole in the wall. You find a long, dark hallway with a few cell doors.")
    type("You make your way down the hall to the first door. It pushes open.")
    type("Just as it does, you see a shadowy figure appear at the end of the hallway.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Attack the figure.", "Hide inside the cell.", "Do Nothing."], state)
    if choice == 1:
        type("You let out a loud scream in an attempt to get your adrenaline pumping. The figure steps forward and you feel a wave of fear.")
        type("You take every last bit of courage you have and begin sprinting toward the figure. You get about halfway up the hall when the figure takes a single step forward and raises his hand.")
        type("You immediately feel a weight in your chest and you stop, completely frozen. Unable to move. Your throat starts to tighten and it becomes harder to breathe.")
        type("As the figure walks toward you, a strong force begins to lift you off the ground. The figure takes his final step before reaching you and drives his sword into your chest.")
        time.sleep(0.15)
        death("You are unable to escape. The Warden killed you.", state)
    elif choice == 2:
        return "hide_cell"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def hide_cell(state):
    type("You rush inside the cell. You peek around the edge and see the figure slowly walking towards you. You run inside and start scanning the room.")
    type("You find a bed roll with a burlap sack as a blanket, a small wooden box, and a dead mouse in the corner.")
    time.sleep(0.15)
    choice = choose("Select your next action:", ["Open the box.", "Pick up the mouse and throw it down the hallway.", "Do Nothing."], state)
    if choice == 1:
        return "open_box"
    elif choice == 2:
        return "throw_mouse"
    elif choice == 3:
        return "nothing"
    elif choice == "quit":
        return "quit"
    
def open_box(state):
    type("You run over to the box and the top pops open easily. The large wooden box holds a single small blade. You pick it up and hide in the corner of the room, next to the door.")
    type("The sound of slow, heavy footsteps gets louder until 2 boots come together right outside the door.")
    type("The figure slowly walks into the room, looking right past you and facing the back wall.")
    return "fight_man"
    
def fight_remaining_guards(state):
    type("You start to fight the remaining guards. They seem to be a bit more experienced than you are.")
    type("Still dazed, you manage to knock one of the guards down and get his weapon.")
    type("The other 2 guards finally gain their composure and start to fight back. You manage to knock another one of them down.")
    type("Just as you do, the 4th guard comes back with help. 6 more guards enter the room and start to attack you.")
    time.sleep(0.15)
    death("You are unable to escape. The guards beat you up until you are dead.", state)

def kick_bucket_1(state):
    type("You are able to scoot over into a position to reach over and kick the bucket. Your kick lands well and the bucket bounces and rolls across the room.")
    type("The guards are angered by your actions. They start to yell at you. One of the guards gets out of his seat and grabs the bucket. He stumbles a bit as he tries.")
    type("You then notice all the glasses on the tables surrounding the guards. They're drunk.")
    type("As the guards walks back towards you with the bucket, he accidentally kicks the key and it falls on the ground next to you.")
    type("He sets the bucket down and gives you a cheap shot in the ribs as he walks away. You let out and audible grunt as the wind is knocked out of you.")
    time.sleep(0.15)
    choice = choose("Select your next action: ", ["Grab the key.", "Kick the bucket.", "Pull on the chains.", "Do Nothing"], state)
    if choice == 1 and not state["chains"]:
        type("You attempt to grab the key but your chains are too tight and you can't reach it.")
        time.sleep(0.15)
        choice1 = choose("Select your next action: ", ["Kick the bucket.", "Pull on the chains.", "Do Nothing."], state)
        if choice1 == 1:
            return "kick_bucket_2"
        elif choice1 == 2:
            return "pull_chains"
        elif choice1 == 3:
            return "nothing"
        elif choice1 == "quit":
            return "quit"
    elif choice == 1 and state["chains"]:
        type("With your loosened chains, you are able to reach and grab the key.")
        type("You try to fit the key inside the lock on your chains. It's a perfect fit and the lock clicks open.")
        type("The guards hear your chains fall to the ground and they all drunkenly stumble to their feet.")
        type("In their stupor, they struggle to grab their weapons and it gives you a chance to think...")
        time.sleep(0.15)
        choice2 = choose("Select your next action: ", ["Throw the bucket at the guards.", "Run for the open door behind the guards.", "Pull on the chains.", "Do Nothing."], state)
        if choice2 == 1:
            return "throw_bucket"
        elif choice2 == 2:
            return "run_door"
        elif choice2 == 3:
            return "pull_chains_free"
        elif choice2 == 4:
            return "nothing"
        elif choice2 == "quit":
            return "quit"
    elif choice == 2:
        return "kick_bucket_2"
    elif choice == 3:
        return "pull_chains"
    elif choice == 4:
        return "nothing"
    elif choice == "quit":
        return "quit"

def kick_bucket_2(state):
    type("You position yourself again to kick the bucket. Your kick lands well and the bucket bounces and rolls across the room.")
    type("'That's enough, your time is up!' shouts one of the guards.")
    type("The guards start to stumble towards you, wooden clubs in hand")
    time.sleep(0.15)
    death("You are unable to escape as the guards beat you to death.", state)

# Main function that runs the game loop

def main():
    escape = False
    
    display_title()

    # Attempt to load previous game data, if it exists. And give the user the option to load or start a new game
    saved_state = load_game_data()
    if saved_state:
        choice = input("Do you want to load your saved game? (y/n): ").lower()
        if choice == "y":
            state = saved_state
        else:
            state = {"player_name": None, "scene": None, "previous_scene": None, "chains": False, "decisions": [], "outcome": None}
            state["player_name"] = get_player_name(state)
    # If there is no saved game data, start a new game
    else:
        state = {"player_name": None, "scene": None, "previous_scene": None, "chains": False, "decisions": [], "outcome": None}
        state["player_name"] = get_player_name(state)

    type("\nWelcome, " + state["player_name"] + "!\n")

    scenes = get_scenes()
    current_scene = state["scene"]

    if current_scene not in scenes:
        type("Choose a starting location.")
        starting_location = get_starting_location()
        state["scene"] = starting_location
    else:
        type("\nReturning to your game...\n")
    while not escape:    
        if state["scene"] not in scenes:
            print(f"Scene '{state['scene']}' does not exist. Please choose a valid scene.")
            state["scene"] = get_starting_location()
            continue
            
            #get the function for the current scene
        scene_func = scenes[state["scene"]] 
            #run the scene and capture the next scene's name
        next_scene = scene_func(state)

        if next_scene is None:
            continue
        elif next_scene == "replay":
            replay()
        elif next_scene == "quit":
            escape = True
            break
        else:
                #update the game state to reflect scene change
            change_scene(state, next_scene)
        

    if escape:
        print("Thanks for playing!")
        exit()

# Call the main function
if __name__ == "__main__": 
    main()